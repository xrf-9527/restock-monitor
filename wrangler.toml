name = "restock-monitor"
main = "src/index.ts"
compatibility_date = "2024-12-15"
compatibility_flags = ["nodejs_compat"]

# 自定义域名配置
routes = [
    { pattern = "restock.xrf.sh", custom_domain = true }
]

# KV 命名空间绑定 - 用于存储状态
# 部署前需要创建: npx wrangler kv namespace create STOCK_STATE
# 然后将返回的 id 填入下方
[[kv_namespaces]]
binding = "STOCK_STATE"
id = "8cf958b69cf642c8a4c511fb9246c02a"
preview_id = "296007bfeff442c7ab6a986d01dd89b5"

# Cron Triggers - 每 2 分钟执行一次
[triggers]
crons = ["*/2 * * * *"]

# 环境变量（非敏感信息）
[vars]
TIMEOUT_SEC = "15"
CONFIRM_DELAY_MS = "2000"
IN_CONFIRMATIONS_REQUIRED = "1"
ERROR_STREAK_NOTIFY_THRESHOLD = "5"
ERROR_NOTIFY_COOLDOWN_SEC = "1800"
ALERT_PREFIX = ""
USER_AGENT = ""
TARGETS_JSON = ""

# Browser Rendering 绑定 - 用于绕过 WAF/反爬
[browser]
binding = "BROWSER"

# Workers Logs 配置 - 用于日志记录和调试
[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true

# Secrets（敏感信息）通过 wrangler secret put 添加:
# - ADMIN_TOKEN (可选：保护 HTTP 端点)
# - TG_BOT_TOKEN
# - TG_CHAT_ID
# - FEISHU_WEBHOOK_URL
# - FEISHU_SECRET
# - DINGTALK_WEBHOOK_URL
# - DINGTALK_SECRET
